---
title: 'How do You Define Track Offsets for Pin Alignment'
date: 2024-01-29
permalink: /posts/2024/01/blog-post-4/
tags:
  - ASIC Design
  - PnR
  - Floorplan
  - Placement
---

Problem:
========
# *Questions:*
 
####  Question 1: Can you illustrate the track offset concept with a snapshot?
####  Question 2: You have a block pin spreadsheet with each pin’s coordinates. But as the pins are not on the track, you want to shift the block tracks to align with the pins. How can you set the offsets for the required tracks to achieve this?
####  Question 3: Are there any guidelines to follow while choosing the track offset value?

Solution:
=========
#### Solution 1: 
The track offset is the distance from the standard cell edge to the center of the pin.
* In the following example, the M1 (metal layer 1) track offset is the vertical distance between the horizontal edge of the cell and the center of the closest M1 pin. 
* The M2 track offset is the horizontal distance between the vertical edge of the cell and the center of the closest M2 pin. 

![image](https://github.com/abdelazeem201/abdelazeem201.github.io/assets/58098260/5094f136-2be6-4925-9554-96031a2341f8)

The lower-left corner (origin) of your block’s core area is (0,0). By default, horizontal and vertical metal tracks start at this origin and are spaced a pitch apart (defined in the technology file). 
For maximum standard cell placement flexibility (flipping along the x-axis for abutted row placement, and along the y-axis for symmetrical placement within rows), you must not place the standard cell pins along the edges of the cells as this might cause the pins of abutted cells to short.
To align with the metal routing tracks, you must space the standard cell pins an entire minimum pitch away from the cell edges, which can restrict the pin placement within cells.  

#### Solution 2:
Use any of the following methods to set track offsets in your design:

* Method 1: By removing tracks and then recreating them with the required offset in the required direction, for example:

```````````````````````
remove_tracks -all
create_track -layer M2  -offset 0.032 -relative_to block_boundary -dir Y
create_track -layer M3  -offset 0.032 -relative_to block_boundary -dir X
..
..
````````````````````````
Note: Instead of removing all the tracks by using the remove_tracks -all command, you can just selectively remove only the tracks that you want to recreate.
For example, remove_tracks -layer m3 -dir X.
You can use the create_track command with the -offset option, as shown earlier to have the track start at the required track offset.

* Method 2: By setting the track_offset attribute for individual layers as per your requirement, for example:
`````````````````````````````````````
set_attribute [get_layers M2] track_offset 0.032
set_attribute [get_layers M3] track_offset 0.032
`````````````````````````````````````
But for this to take effect, you must do this before running the initialize_floorplan command, which is when the tracks are drawn.

* Method 3: Using a PRF file
The Physical Rules File (PRF) is a new standard to define many parameters pertaining to the physical rules of a technology. The track offsets can be defined there as well.

 #### Solution 3:
From the DRC spacing perspective (while also ensuring alignment to metal tracks), pins can be as close as a half pitch away from the cell edge. Therefore, if standard cell pins are placed less than a track pitch away from the edges, you need to specify a track offset, which is equal to this pin offset allowed within the standard cells.
 
For example, half the minimum pitch value is measured from the cell edge to the center of the pin. This ensures that the metal routes align with their corresponding metal pins.

References:
===========
1. [LEF/DEF Language Reference](https://www.ispd.cc/contests/18/lefdefref.pdf)
2. [Standard Cell Library/Library Exchange Format (LEF)](https://www.csee.umbc.edu/~cpatel2/links/641/slides/lect04_LEF.pdf)
